---
slug: '2025-03-19-react-fiber'
title: 'React fiber'
description: 'React v16부터 도입된 fiber에 대해서 알아봅니다.'
date: '2025-03-19'
tags: ['react', 'javascript']
---

import { StackReconciler } from './components/stack-reconciler';

# React Fiber 아키텍처

## Fiber 이전의 리액트 내부 메커니즘

리액트는 기존에 `Stack Reconciler`라는 방식의 메커니즘을 사용하였습니다.
이를 간단하게 말해보면 **재귀**를 통해 변경사항을 파악하고 이를 **한번에** 업데이트하는 방식입니다.
이러한 방식은 매우 직관적이지만 몇가지 문제가 있었습니다.

### 대규모 업데이트 시 발생하는 frame drop 현상

리액트는 어쨋든 자바스크립트 라이브러리이고, 이말은 즉 싱글쓰레드라는 뜻입니다.
이를 인지하고 위 방식을 다시 생각해보면 **모든 변경사항을 한번에 업데이트**하는 방식에는 분명 문제가 발생할것입니다.
왜냐하면 업데이트, 즉 UI 변경을 반영한다는 것은 콜 스택을 점유한다는 의미입니다.
근데 점유된 작업이 매우 큰 분량의 작업이라면 다른 작업이 그동안 차단된다는 뜻이기도 합니다.

이를 수치적으로 말하면, 브라우저는 기본적으로 하나의 업데이트를 60fps(16ms)에 처리해야 사용자 입장에서 끊김없는 부드러운 업데이트가 이루어진다고 알려져있습니다.

> 참고: [dev.to](https://dev.to/bnevilleoneill/a-deep-dive-into-react-fiber-internals-5cld?comments_sort=latest#:~:text=Having%20said%20that,drop%20that%20frame.)

하지만 만약에 작업이 매우 커서 이 범위를 넘어간다면 사용자에게는 일종의 끊김 현상 ( janky )이 발생합니다.

또한 이후 설명할 동시성모드의 핵심인 우선순위 업데이트가 이 메커니즘에서는 존재하지 않기 때문에 상대적으로 중요한 업데이트가 우선 업데이트 되지 못하였습니다.
예를들어 유저의 입력같이 즉각적인 피드백이 나와야하는 중요한 업데이트가 차단되는 현상이 존재하였습니다.

```md
사용자 입력 시작
|
v
대규모 DOM 업데이트 시작
|
v
대구모 DOM 업데이트 완료 전까지 사용자 입력이 차단됨
```

<StackReconciler />

## Fiber 도입

리액트 팀 또한 이러한 문제의 심각성을 인지하고 있었고, 이 문제를 해결하고 더 나은 리액트를 구현하기 위해서 v16부터 새로운 reconciler을 선보입니다.
이때 리액트 팀에서 잡은 핵심 목표는 아래와 같습니다

> 참고: [React 맴버 깃허브](https://github.com/acdlite/react-fiber-architecture)

- 작업을 적절한 **우선순위**에 따라 처리 (애니메이션 등 긴급한 작업을 우선 수행)
- **작업을 일시 중지**했다가 나중에 재개 (브라우저 프레임 예산을 초과하지 않도록)
- 더 이상 필요 없는 작업은 **중단/취소**
- 이전 완료된 작업 결과를 **재사용** (불필요한 연산 줄이기)

Fiber의 핵심은 작업 단위를 여러개로 찢는 방식입니다.
이렇게 여러개로 찢은 후 각 작업 사이에 브라우저 제어를 넘겨주는 방식으로 위의 문제를 해결하려 접근하였습니다.
