# 6. `import.meta` 심화

[← 목차로 돌아가기](./README.md) | [← 이전: \_\_dirname과 cwd](./05-dirname-cwd.md)

---

## Q&A: `import.meta`란?

### Q: `import.meta`는 정확히 뭔가요?

### A: ESM 스펙이 정의한 **"현재 모듈에 대한 메타데이터를 담는 객체"**입니다.

| 특징          | 설명                                 |
| ------------- | ------------------------------------ |
| **스코프**    | ESM 모듈 안에서만 접근 가능 (전역 X) |
| **스펙 정의** | 객체 껍데기만 정의                   |
| **내용물**    | 런타임(호스트)이 채움                |

```javascript
// ESM 모듈 안에서
console.log(import.meta); // ✅ 동작

// 일반 스크립트
console.log(import.meta); // ❌ SyntaxError
```

---

## 런타임별 제공 속성

| 런타임/도구     | 속성                  | 설명                           |
| --------------- | --------------------- | ------------------------------ |
| **브라우저**    | `url`                 | 스크립트 URL (`https://...`)   |
| **Node.js**     | `url`                 | 파일 URL (`file:///...`)       |
| **Node 20.6+**  | `resolve(specifier)`  | import 경로를 절대 URL로 해석  |
| **Node 20.11+** | `dirname`, `filename` | `__dirname`, `__filename` 대체 |
| **Deno**        | `url`, `main`         | `main`: 엔트리 모듈 여부       |
| **Vite**        | `env`, `hot`, `glob`  | 빌드/HMR/글로빙 기능           |

---

## Q&A: CJS vs ESM 설계 철학

### Q: ESM은 왜 `__dirname`을 기본 제공하지 않나요?

### A: **플랫폼 중립적** 설계 때문입니다.

**CJS (CommonJS)**:

> "Node.js가 모듈 시스템이 없던 시절, **자체적으로 만든** 모듈 시스템"

- 2009년, Node.js 탄생과 함께 등장
- **표준이 아님** (ECMA 스펙 X)
- Node.js 특성에 최적화

**ESM (ECMAScript Modules)**:

> "JS 언어 **공식 표준**으로, 모든 환경에서 동작하도록 설계"

- 2015년 ES6에서 언어 스펙으로 추가
- **브라우저/Node/Deno/Bun** 모두 지원
- 플랫폼 특화 기능은 `import.meta`로 **확장 지점**만 제공

---

## Q&A: `import.meta`는 확장 지점인가요?

### Q: `import.meta`는 결국 입구만 정의하고, 그 안에서 뭘 제공할지는 각 런타임이 결정하는 건가요?

### A: **정확합니다.**

**한 줄 정리**:

> **`import.meta` = ESM 스펙이 정의한 "확장 지점(extension point)"**
>
> 스펙: "여기에 객체 하나 줄게. 뭘 넣을지는 니가 알아서 해."

**구조 다이어그램**:

```
┌─────────────────────────────────────────┐
│           ECMAScript 스펙               │
│  "import.meta는 객체다. 내용은 호스트가 │
│   채운다."                              │
└─────────────────────────────────────────┘
              │
    ┌─────────┼─────────┐
    ▼         ▼         ▼
┌─────────┐ ┌─────────┐ ┌─────────┐
│ 브라우저 │ │ Node.js │ │  Vite   │
│         │ │         │ │(번들러) │
│ .url    │ │ .url    │ │ .url    │
│         │ │ .dirname│ │ .env    │
│         │ │ .resolve│ │ .hot    │
│         │ │         │ │ .glob   │
└─────────┘ └─────────┘ └─────────┘
```

**비유**:

| 비유              | 설명                                                 |
| ----------------- | ---------------------------------------------------- |
| **USB 포트**      | 포트 규격만 정의, 뭘 꽂을지는 제조사가 결정          |
| **콘센트**        | 220V 규격만 정의, 어떤 기기 연결할지는 사용자가 결정 |
| **`import.meta`** | 객체 존재만 보장, 내용은 런타임이 결정               |

---

## 실무 주의점

`import.meta.xxx`를 쓸 때는 **어떤 환경에서 실행되는지** 확인해야 합니다:

```javascript
// ❌ 위험: 모든 환경에서 동작한다고 가정
const apiUrl = import.meta.env.VITE_API_URL; // Vite 전용

// ✅ 안전: 환경 체크
const apiUrl = import.meta.env?.VITE_API_URL ?? process.env.API_URL;
```

---

## 한 문장 정리

> "CJS는 Node.js가 자체 구현한 모듈 시스템이라 Node 특화 기능(`__dirname`)을 기본 제공하고, ESM은 JS 언어 표준이라 플랫폼 중립적인 것만 정의하고 특화 기능은 `import.meta`를 통해 각 런타임이 추가한다."

---

[다음: 체크리스트 →](./07-checklist.md)
